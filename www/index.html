<!doctype html>
<html lang="en">
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">


		<!-- Optional JavaScript -->
    <!-- jQuery first, then Popper.js, then Bootstrap JS -->
    <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>

    <title>Digitalife Display Ads</title>
  </head>
  <body>

     <div class="app">
        <!-- <h1>PhoneGap</h1> -->
        <div id="deviceready" class="blink">
            <p class="event listening">Connecting to Device</p>
            <p class="event received">Device is Ready</p> 
         </div> 
    </div>
  	
   <style>
  #front { position:absolute; left:10; top: 60px;color:#fff; background:#111; opacity:0.4; padding: 0.2em; font-size:2em; text-align:center;z-index:200 }
</style>
<iframe width="100%" height="720" id="youtubeFrame" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe> 

<div id="front"></div>

<script type='text/javascript' src='http://www.youtube.com/iframe_api'></script>

    <script type="text/javascript" src="js/index.js"></script>
    <script type="text/javascript">
        app.initialize();
    </script>

<script>
  
  $(document).ready(function(){
    
    $("body").attr("style","background:#000");
    $("#youtubeFrame").attr("width",screen.width-20);
    $("#youtubeFrame").attr("height",screen.height-20);
    $("#youtubeFrame").attr("style","overflow:none");
 
  });
  
  
  var ws = null; 
  var user = {}; 
  
// Init WebSocket connection
  function ws_init() {
    
    var href = location.href;
    href = href.replace("admin","");
    // console.log(href);
    href = "http://ads.digitalife.top/content/kk";
    ws = new WebSocket(href.replace(/^https/gi, 'wss').replace(/^http/gi, 'ws'));

    ws.onopen = function() {
      clientActionOnOpen(); 
    };

    ws.onclose = function(e) {
      clientActionOnClose();
    };

    ws.onmessage = function(e) {
      var messageFromServer = JSON.parse(decodeURIComponent(e.data));
      clientActionUi(messageFromServer);
      
    };
  }
  
    // Sends message
  function ws_send(messageToServer) {
    if (!ws)
      return
    messageToServer.id = user.id;   // bat buoc !!
    console.log(user);
    ws.send(encodeURIComponent(JSON.stringify(messageToServer)));
    return true;
  }
  
  // Initialization
  setTimeout(ws_init, 1000);
  
  
  function clientActionOnOpen(){
    console.log("OPEN");
    $("#serverResponse").append("<p>I opened</p>");
    $("#front").html("Display connected. Press F11 to start.");
    return;
  }
  
  function clientActionOnClose(){
    //logoff 
      window.location.href = "/content/show";
      ws = null;
      console.log("CLOSE");
  }

  function clientActionUi(messageFromServer){
    var type = messageFromServer.type;
    console.log(type);
    
    switch (type) {
        case 's-open':
          $("#serverResponse").append("<p>"+messageFromServer.text+"</p>");
          return;
        case 's-close':
          $("#serverResponse").append("<p>"+messageFromServer.text+"</p>");
          return;
        case 's-chat':
          $("#serverResponse").append("<p>"+messageFromServer.text+"</p>");
          return;
        case 's-question':
          questionUI(messageFromServer);
          return; 
        case 's-answer':
          answerUI(messageFromServer);
          return; 
        case 's-video':
          playVideo(messageFromServer);
          return;   
        case 's-schedule':
          playVideo(messageFromServer);
          return; 
      }
  }
  
  

  function playVideo(messageFromServer){
    var youtubeUrl = messageFromServer.youtubeUrl;
    $("#youtubeFrame").attr("src",youtubeUrl);
    $("#front").text(messageFromServer.name); 
    
  }
   
   </script> 
  </body>
</html>
